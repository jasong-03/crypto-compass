# Code Standards & Conventions

## Directory Structure Conventions

### Root Directory Organization

```
crypto-compass/
├── src/                    # Application source code
│   ├── components/         # React components
│   │   ├── ui/            # shadcn/ui components (auto-generated)
│   │   └── *.tsx          # Custom application components
│   ├── hooks/             # Custom React hooks
│   ├── lib/               # Utility functions and business logic
│   ├── pages/             # Page-level components (route targets)
│   ├── types/             # TypeScript type definitions
│   ├── data/              # Mock data and constants
│   ├── App.tsx            # Root application component
│   ├── main.tsx           # Application entry point
│   └── index.css          # Global styles and Tailwind directives
├── docs/                  # Project documentation
├── public/                # Static assets
├── node_modules/          # Dependencies (gitignored)
├── package.json           # Project metadata and dependencies
├── tsconfig.json          # TypeScript configuration
├── vite.config.ts         # Vite build configuration
├── tailwind.config.ts     # Tailwind CSS configuration
└── components.json        # shadcn/ui configuration
```

### Component Directory Rules

**Custom Components (`src/components/`):**
- One component per file
- File name matches component name (PascalCase)
- Example: `DashboardHeader.tsx` exports `DashboardHeader`

**UI Components (`src/components/ui/`):**
- Generated by shadcn/ui CLI
- DO NOT modify manually (will be overwritten)
- Import and compose in custom components
- Example: `import { Button } from '@/components/ui/button'`

**Hooks (`src/hooks/`):**
- Prefix with `use` (React convention)
- One hook per file
- Example: `useCryptoData.ts` exports `useCryptoData`

**Pages (`src/pages/`):**
- Route-level components only
- Default exports for React Router compatibility
- Example: `Index.tsx` default exports `Index` component

**Types (`src/types/`):**
- Group related types in single files
- Use `.ts` extension (not `.tsx`)
- Example: `crypto.ts` contains all crypto-related types

## Naming Conventions

### TypeScript Types and Interfaces

**Interfaces:**
```typescript
// PascalCase for interface names
interface TokenData {
  parentProtocol: string;
  symbol: string;
}

// Suffix with "Props" for component props
interface TokenTableProps {
  tokens: TokenData[];
  isLoading: boolean;
}

// Suffix with "Response" for API responses
interface FundamentalApiResponse {
  data: FundamentalToken[];
  page?: number;
}
```

**Type Aliases:**
```typescript
// PascalCase for type names
type SentimentType = 'bullish' | 'bearish' | 'neutral';

// Prefix with "On" for event handlers
type OnRowClick = (token: TokenData) => void;
```

### Variables and Functions

**Variables:**
```typescript
// camelCase for variables
const tokenCount = 10;
const isLoading = true;

// UPPERCASE for constants
const FUNDAMENTAL_API = 'https://...';
const LIMIT = 20;
const USE_MOCK_DATA = false;
```

**Functions:**
```typescript
// camelCase for function names
function calculateFundamentalSentiment(rankDescription: string): SentimentType {
  // ...
}

// Prefix boolean-returning functions with "is", "has", "should"
function isLoading(): boolean { /* ... */ }

// Event handlers: prefix with "handle"
const handleRowClick = (token: TokenData) => {
  // ...
};

// Async functions: descriptive verb phrases
async function fetchFundamentalData(page: number): Promise<FundamentalApiResponse> {
  // ...
}
```

### React Components

**Component Names:**
```typescript
// PascalCase for component names
export function DashboardHeader() { /* ... */ }

// Matches file name
// File: TokenRow.tsx
export function TokenRow() { /* ... */ }
```

**Component Props:**
```typescript
// Destructure props in function signature
export function TokenTable({ tokens, isLoading }: TokenTableProps) {
  // ...
}

// Prefix callback props with "on"
interface TokenRowProps {
  token: TokenData;
  onRowClick: (token: TokenData) => void;
}
```

**Custom Hooks:**
```typescript
// Always prefix with "use"
export function useCryptoData(page: number) {
  // ...
}

// Return object for multiple values
return {
  tokens,
  pagination,
  isLoading,
  refetch
};
```

### CSS Classes

**Tailwind Utility Classes:**
```tsx
// Group by category: layout, spacing, typography, colors, effects
<div className="flex items-center gap-3 px-4 py-2 text-sm font-semibold bg-card rounded-lg border border-border">
```

**Class Merging:**
```typescript
// Use cn() utility for conditional classes
import { cn } from '@/lib/utils';

<div className={cn(
  "base-classes",
  isActive && "active-classes",
  variant === 'primary' && "primary-classes"
)}>
```

## TypeScript Patterns

### Type Safety

**Strict Mode Enabled:**
```json
// tsconfig.json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true
  }
}
```

**Explicit Return Types:**
```typescript
// Always specify return types for functions
function calculateOverallSentiment(
  fundamental: SentimentType,
  onchain: SentimentType,
  technical: SentimentType
): SentimentType {
  // ...
}
```

**Type Assertions:**
```typescript
// Use "as const" for literal types
const technical = 'neutral' as const;

// Use type guards for narrowing
if (typeof value === 'number') {
  // TypeScript knows value is number here
}
```

### API Response Handling

**Optional Chaining:**
```typescript
// Safe access to nested properties
const data = json.data || json;
const logo = fundToken?.logo || '';
```

**Nullish Coalescing:**
```typescript
// Prefer ?? over || for default values
const page = json.page ?? 1;
const limit = json.limit ?? LIMIT;
```

**Type Guards:**
```typescript
// Check array before iteration
if (fundamentalQuery.data?.data && Array.isArray(fundamentalQuery.data.data)) {
  for (const fundToken of fundamentalQuery.data.data) {
    // ...
  }
}
```

### React Patterns

**Function Components Only:**
```typescript
// Use function components, not class components
export function MyComponent({ prop1, prop2 }: MyComponentProps) {
  return <div>...</div>;
}
```

**Hooks at Top Level:**
```typescript
export function MyComponent() {
  // All hooks at top of component
  const [state, setState] = useState(0);
  const query = useQuery({ /* ... */ });

  // Conditional logic after hooks
  if (query.isLoading) {
    return <LoadingSkeleton />;
  }

  return <div>...</div>;
}
```

**Custom Hook Pattern:**
```typescript
// Encapsulate complex logic in custom hooks
export function useCryptoData(page: number) {
  // Use built-in and other hooks
  const fundamentalQuery = useQuery({ /* ... */ });
  const onchainQuery = useQuery({ /* ... */ });

  // Compute derived state
  const isLoading = fundamentalQuery.isLoading || onchainQuery.isLoading;

  // Return object with data and methods
  return {
    tokens,
    pagination,
    isLoading,
    refetch
  };
}
```

## Component Structure Guidelines

### Standard Component Template

```typescript
// 1. Imports
import { useState } from 'react';
import { SomeType } from '@/types/some-type';
import { useCustomHook } from '@/hooks/useCustomHook';
import { helperFunction } from '@/lib/utils';
import { UIComponent } from '@/components/ui/ui-component';

// 2. Type Definitions
interface MyComponentProps {
  prop1: string;
  prop2?: number;
  onEvent: () => void;
}

// 3. Helper Functions (if scoped to this component)
function formatData(data: string): string {
  return data.toUpperCase();
}

// 4. Component
export function MyComponent({ prop1, prop2 = 0, onEvent }: MyComponentProps) {
  // 4a. Hooks
  const [localState, setLocalState] = useState(false);
  const { data, isLoading } = useCustomHook();

  // 4b. Computed Values
  const formattedData = formatData(prop1);

  // 4c. Event Handlers
  const handleClick = () => {
    setLocalState(!localState);
    onEvent();
  };

  // 4d. Early Returns (loading, errors, empty states)
  if (isLoading) {
    return <div>Loading...</div>;
  }

  // 4e. Main Render
  return (
    <div className="container">
      <h1>{formattedData}</h1>
      <UIComponent onClick={handleClick} />
    </div>
  );
}
```

### Component Organization Rules

**1. Keep Components Focused:**
- Single Responsibility Principle
- Extract subcomponents if JSX exceeds 100 lines
- Move complex logic to custom hooks

**2. Props Destructuring:**
```typescript
// Good: Destructure in signature
export function MyComponent({ prop1, prop2 }: Props) {
  return <div>{prop1}</div>;
}

// Avoid: Using props object
export function MyComponent(props: Props) {
  return <div>{props.prop1}</div>;
}
```

**3. Conditional Rendering:**
```typescript
// Good: Early returns for loading/error states
if (isLoading) return <LoadingSkeleton />;
if (isError) return <ErrorMessage />;

// Good: Ternary for simple conditions
{isActive ? <ActiveState /> : <InactiveState />}

// Good: Logical AND for optional rendering
{showBanner && <Banner />}

// Avoid: Deeply nested ternaries
{condition1 ? (condition2 ? <A /> : <B />) : (condition3 ? <C /> : <D />)}
```

## Styling Approach

### Tailwind CSS Conventions

**Utility-First Approach:**
```tsx
// Use Tailwind utilities directly in className
<div className="flex items-center justify-between p-4 bg-white rounded-lg shadow-md">
  <h2 className="text-xl font-bold text-gray-900">Title</h2>
  <button className="px-4 py-2 text-white bg-blue-500 hover:bg-blue-600 rounded">
    Click Me
  </button>
</div>
```

**Responsive Design:**
```tsx
// Mobile-first breakpoints
<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
  {/* Responsive grid */}
</div>
```

**Dark Mode Support:**
```tsx
// Use dark: variant for dark mode
<div className="bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
  {/* Content */}
</div>
```

### shadcn/ui Integration

**Component Usage:**
```tsx
// Import shadcn/ui components
import { Button } from '@/components/ui/button';
import { Card, CardHeader, CardContent } from '@/components/ui/card';

// Use with props
<Button variant="outline" size="sm" onClick={handleClick}>
  Click Me
</Button>

// Compose into custom components
export function MyCard() {
  return (
    <Card>
      <CardHeader>Header</CardHeader>
      <CardContent>Content</CardContent>
    </Card>
  );
}
```

**Component Variants:**
```tsx
// shadcn/ui components use class-variance-authority (cva)
import { Button } from '@/components/ui/button';

// Variants defined in ui component
<Button variant="default">Primary</Button>
<Button variant="destructive">Delete</Button>
<Button variant="outline">Secondary</Button>
<Button variant="ghost">Tertiary</Button>

// Sizes
<Button size="sm">Small</Button>
<Button size="default">Medium</Button>
<Button size="lg">Large</Button>
```

**Custom Styling:**
```tsx
// Extend shadcn/ui components with additional classes
<Button className="mt-4 w-full">
  Full Width Button
</Button>

// Use cn() for conditional styling
<Button className={cn(
  "base-classes",
  isActive && "bg-green-500"
)}>
  Conditional
</Button>
```

### CSS Variables (Design Tokens)

**Theme Colors:**
```css
/* src/index.css */
@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 240 10% 3.9%;
    --card: 0 0% 100%;
    --card-foreground: 240 10% 3.9%;
    --primary: 240 5.9% 10%;
    --primary-foreground: 0 0% 98%;
    /* ... more variables */
  }

  .dark {
    --background: 240 10% 3.9%;
    --foreground: 0 0% 98%;
    /* ... dark mode values */
  }
}
```

**Custom Colors:**
```typescript
// tailwind.config.ts
export default {
  theme: {
    extend: {
      colors: {
        // Custom sentiment colors
        'crypto-bullish': '#10b981',
        'crypto-bearish': '#ef4444',
        'crypto-neutral': '#6b7280',
      }
    }
  }
}
```

## File Organization Best Practices

**Import Order:**
```typescript
// 1. External libraries
import { useState, useEffect } from 'react';
import { useQuery } from '@tanstack/react-query';

// 2. Internal types
import { TokenData, SentimentType } from '@/types/crypto';

// 3. Custom hooks
import { useCryptoData } from '@/hooks/useCryptoData';

// 4. Utilities and helpers
import { cn } from '@/lib/utils';
import { calculateSentiment } from '@/lib/sentiment';

// 5. Components (shadcn/ui first, then custom)
import { Button } from '@/components/ui/button';
import { Card } from '@/components/ui/card';
import { DashboardHeader } from '@/components/DashboardHeader';

// 6. Icons
import { AlertCircle, RefreshCw } from 'lucide-react';
```

**Path Aliases:**
```typescript
// Use @ alias for src directory (configured in tsconfig)
import { TokenData } from '@/types/crypto';
import { useCryptoData } from '@/hooks/useCryptoData';

// Avoid relative paths
// Bad: import { TokenData } from '../../../types/crypto';
```

**Export Patterns:**
```typescript
// Named exports for utilities and hooks
export function calculateSentiment() { /* ... */ }
export function useCryptoData() { /* ... */ }

// Default exports for pages (React Router requirement)
export default function Index() { /* ... */ }

// Both for components (flexible usage)
export function DashboardHeader() { /* ... */ }
export default DashboardHeader;
```

## Code Quality Standards

**ESLint Configuration:**
- React Hooks rules enforced
- TypeScript-specific linting
- React Refresh plugin for HMR

**Code Formatting:**
- Consistent indentation (2 spaces)
- Semicolons required
- Single quotes for strings (except JSX)
- Trailing commas in objects/arrays

**Comments:**
```typescript
// Use comments for complex logic explanation
// Match SQL logic:
// CASE
//   WHEN bullish_count >= neutral_count AND bullish_count >= bearish_count THEN 'bullish'
//   ELSE 'bearish'
// END

// Document non-obvious decisions
// Use onchain data as primary source (48 tokens) and match with fundamental data

// Avoid obvious comments
// Bad: // Set state to true
setState(true);
```

---

**Document Version:** 1.0
**Last Updated:** 2025-12-23
